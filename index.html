<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebLog.NiggaServis | GeliÅŸmiÅŸ Analiz Platformu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark-space: #020314;
            --accent-primary: #00A9FF;
            --accent-secondary: #A600FF;
            --panel-bg: rgba(18, 17, 39, 0.6);
            --panel-border: rgba(58, 52, 102, 0.5);
            --text-primary: #e2e8f0;
            --text-secondary: #8c9bb3;
            --text-dark: #0f172a;
        }

        body {
            background-color: var(--bg-dark-space);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            position: relative;
        }

        #background-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }

        .stars { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-repeat: repeat; background-size: cover; opacity: 0.7; }
        #stars1 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><circle cx="15%" cy="20%" r="1" fill="white" opacity="0.8"/><circle cx="80%" cy="10%" r="1" fill="white" opacity="0.8"/><circle cx="50%" cy="70%" r="1" fill="white" opacity="0.8"/></svg>'); animation: move-stars 180s linear infinite; }
        #stars2 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><circle cx="30%" cy="50%" r="0.8" fill="white" opacity="0.6"/><circle cx="90%" cy="60%" r="0.8" fill="white" opacity="0.6"/><circle cx="40%" cy="90%" r="0.8" fill="white" opacity="0.6"/></svg>'); animation: move-stars 120s linear infinite; }
        #stars3 { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><circle cx="5%" cy="80%" r="0.6" fill="white" opacity="0.4"/><circle cx="60%" cy="30%" r="0.6" fill="white" opacity="0.4"/></svg>'); animation: move-stars 90s linear infinite; }

        @keyframes move-stars { from { transform: translateY(0); } to { transform: translateY(-100vh); } }
        
        .navbar {
            background: rgba(2, 3, 20, 0.4);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--panel-border);
        }

        .navbar-brand { font-weight: 900; font-size: 1.6rem; color: var(--text-primary); }
        .navbar-brand span { color: var(--accent-primary); font-weight: 600; }

        .analysis-container { min-height: calc(100vh - 70px); display: flex; align-items: center; }

        .analysis-panel {
            width: 100%;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 1rem; padding: 2.5rem;
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            animation: panel-pop 1s ease-out;
        }
        @keyframes panel-pop { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .input-group-lg .form-control {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            color: var(--text-primary);
            font-size: 1.1rem; border-radius: 0.5rem !important;
            padding: 0.9rem 1.2rem;
            box-shadow: none; transition: all 0.3s ease;
        }

        .input-group-lg .form-control:focus {
            background: rgba(0, 0, 0, 0.2); border-color: var(--accent-primary);
            box-shadow: 0 0 25px rgba(0, 169, 255, 0.3), inset 0 0 5px rgba(0, 169, 255, 0.2);
        }

        .btn-analyze {
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary), var(--accent-primary));
            background-size: 250% 100%;
            color: #fff; font-weight: 600; border: none;
            border-radius: 0.5rem !important;
            transition: all 0.5s ease;
        }
        
        .btn-analyze:hover { background-position: 100% 0; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 169, 255, 0.25); }
        .btn-analyze.btn-loading { cursor: not-allowed; }

        .results-container { margin-top: 2.5rem; display: none; }
        
        /* --- DataTables & UI Kit Integration --- */
        .dataTables_wrapper { --bs-table-bg: transparent; --bs-table-striped-bg: rgba(0, 169, 255, 0.03); --bs-table-hover-bg: rgba(0, 169, 255, 0.08); color: var(--text-secondary); font-size: 0.9rem; }
        .dt-layout-row { padding: 0.5rem 0; }
        .dataTables_filter input, .dataTables_length select {
            background-color: rgba(0,0,0,0.2) !important; color: var(--text-secondary) !important;
            border: 1px solid var(--panel-border) !important; border-radius: 0.375rem;
            transition: all 0.3s ease; padding: 0.5rem 0.75rem;
        }
        .dataTables_filter input:focus, .dataTables_length select:focus {
            border-color: var(--accent-primary) !important; box-shadow: 0 0 10px rgba(0, 169, 255, 0.2) !important;
        }
        #resultTable thead th { border-bottom: 2px solid var(--panel-border); color: var(--text-primary); font-weight: 600; }
        #resultTable td { border-color: rgba(58, 52, 102, 0.3); vertical-align: middle; }
        .table-hover > tbody > tr:hover > * { color: #fff !important; }
        .page-item .page-link { background-color: transparent !important; border-color: var(--panel-border) !important; color: var(--text-secondary) !important; margin: 0 2px; border-radius: 0.375rem; }
        .page-item.active .page-link { background: var(--accent-primary) !important; border-color: var(--accent-primary) !important; color: #fff !important; box-shadow: 0 0 10px rgba(0, 169, 255, 0.3); }
        .page-item:not(.active) .page-link:hover { background-color: rgba(0, 169, 255, 0.1) !important; border-color: rgba(0, 169, 255, 0.3) !important; }
        .dataTables_info { padding-top: 0.6rem !important; }

        .toast-container .toast {
            background: rgba(10, 8, 30, 0.7) !important; border: 1px solid var(--panel-border) !important;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 0.75rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .toast-header {
            background: linear-gradient(90deg, rgba(0, 169, 255, 0.15), rgba(166, 0, 255, 0.15)) !important;
            color: var(--text-primary) !important; border-bottom: 1px solid var(--panel-border) !important;
        }
        .btn-close { filter: invert(1) brightness(2) opacity(0.7); }

        .theme-toggle { font-size: 1.5rem; cursor: pointer; background: none; border: none; color: var(--text-secondary); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .theme-toggle:hover { color: var(--accent-primary); transform: rotate(15deg); }
    </style>
</head>
<body>
    <div id="background-container">
        <div id="stars1" class="stars"></div>
        <div id="stars2" class="stars"></div>
        <div id="stars3" class="stars"></div>
    </div>
    
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">WebLog<span>.NiggaServis</span></a>
            <button class="theme-toggle" id="themeToggle" disabled>ðŸŒ™</button>
        </div>
    </nav>

    <main class="container">
        <div class="analysis-container">
            <div class="analysis-panel">
                <div class="input-group input-group-lg">
                    <input type="text" id="searchQuery" class="form-control" placeholder="Milyonlarca kayÄ±t arasÄ±nda arayÄ±n..." autocomplete="off">
                    <button class="btn btn-analyze" type="button" id="btnSorgula">
                        <span class="btn-text">Analiz Et</span>
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
                <div class="results-container" id="resultsContainer">
                    <table id="resultTable" class="table table-hover table-striped w-100"></table>
                </div>
            </div>
        </div>
    </main>

    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
        <div id="resultToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="10000">
            <div class="toast-header">
                <strong class="me-auto">Analiz Ã–zeti</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <dl class="row gx-2 gy-1 mb-0 small">
                    <dt class="col-6 text-secondary">Sunucu</dt><dd class="col-6 text-end fw-bold" id="serverInfo">-</dd>
                    <dt class="col-6 text-secondary">Taranan Veri</dt><dd class="col-6 text-end fw-bold" id="totalData">-</dd>
                    <dt class="col-6 text-secondary">Toplam SonuÃ§</dt><dd class="col-6 text-end fw-bold" id="totalResults">-</dd>
                    <dt class="col-6 text-secondary">Arama SÃ¼resi</dt><dd class="col-6 text-end fw-bold" id="searchTime">-</dd>
                    <dt class="col-6 text-secondary">YanÄ±t SÃ¼resi</dt><dd class="col-6 text-end fw-bold" id="responseTime">-</dd>
                </dl>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    $(document).ready(function () {
        let dataTable = null;
        const apiBase = "https://niggaservis.niggass.workers.dev/api/guncelog?q=";
        const $btnSorgula = $("#btnSorgula");
        const $searchQuery = $("#searchQuery");
        const $resultsContainer = $("#resultsContainer");
        const toastEl = document.getElementById('resultToast');
        const resultToast = new bootstrap.Toast(toastEl);
        
        // Tema deÄŸiÅŸtirme fonksiyonu ve baÅŸlangÄ±Ã§ ayarÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±.
        // Tema kalÄ±cÄ± olarak 'dark' modda. Ä°stenirse tekrar aktif edilebilir.
        // const applyTheme = (theme) => { ... }
        // const savedTheme = 'dark';
        // applyTheme(savedTheme);
        // $('#themeToggle').click(function () { ... });

        const performSearch = async () => {
            const query = $searchQuery.val().trim();
            if (!query) {
                $searchQuery.focus();
                return;
            }

            $btnSorgula.prop("disabled", true).addClass('btn-loading');
            $btnSorgula.find('.btn-text').addClass('d-none');
            $btnSorgula.find('.spinner-border').removeClass('d-none');

            try {
                const res = await fetch(apiBase + encodeURIComponent(query));
                if (!res.ok) throw new Error(`API baÄŸlantÄ± hatasÄ±: ${res.status}`);
                const json = await res.json();

                if (json.basarili && json.veriler && json.veriler.length > 0) {
                    $("#serverInfo").text(json.sunucuBilgisi.platform);
                    $("#totalData").text(json.sunucuBilgisi.toplamVeri);
                    $("#totalResults").text(json.aramaBilgisi.toplamSonuc.toLocaleString());
                    $("#searchTime").text(`${json.aramaBilgisi.elasticAramaSuresiMs} ms`);
                    $("#responseTime").text(`${json.aramaBilgisi.cevapSuresiMs} ms`);
                    resultToast.show();

                    if (dataTable) {
                        dataTable.clear().rows.add(json.veriler.map(v => [v.icerik.log_mesaji || ""])).draw();
                    } else {
                        $resultsContainer.fadeIn(500);
                        dataTable = $("#resultTable").DataTable({
                            data: json.veriler.map(v => [v.icerik.log_mesaji || ""]),
                            columns: [{ title: "Log MesajÄ±" }],
                            responsive: true,
                            language: { url: "//cdn.datatables.net/plug-ins/2.0.8/i18n/tr.json" },
                            pageLength: 10,
                            lengthMenu: [10, 25, 50, 100],
                            stateSave: true,
                        });
                    }
                } else {
                    alert(json.mesaj || "Arama kriterlerinize uygun sonuÃ§ bulunamadÄ±.");
                     if(dataTable) {
                        dataTable.clear().draw();
                     }
                }
            } catch (error) {
                console.error("Analiz HatasÄ±:", error);
                alert("Analiz sÄ±rasÄ±nda kritik bir hata oluÅŸtu. LÃ¼tfen aÄŸ baÄŸlantÄ±nÄ±zÄ± kontrol edin veya daha sonra tekrar deneyin.");
            } finally {
                 $btnSorgula.prop("disabled", false).removeClass('btn-loading');
                 $btnSorgula.find('.btn-text').removeClass('d-none');
                 $btnSorgula.find('.spinner-border').addClass('d-none');
            }
        };

        $btnSorgula.click(performSearch);
        $searchQuery.keypress(e => { if (e.which === 13) performSearch(); });
    });
    </script>
</body>
</html>
